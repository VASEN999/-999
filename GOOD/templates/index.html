<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日本签证材料清单生成器</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4CAF50;
            --primary-light: #80c883;
            --primary-dark: #388e3c;
            --primary-gradient: linear-gradient(135deg, #4CAF50 0%, #388e3c 100%);
            --accent-color: #8bc34a;
            --text-color: #333;
            --muted-color: #6c757d;
            --info-color: #66bb6a;
            --info-bg: #e8f5e9;
            --danger-color: #f44336;
            --danger-bg: #ffebee;
            --warning-color: #ff9800;
            --warning-bg: #fff3e0;
        }
        
        body {
            background-color: #f8f9fa;
            color: var(--text-color);
            padding-top: 1rem;
            padding-bottom: 2rem;
        }
        
        .card {
            border: none;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .card-header {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1.5rem 1rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .option-card {
            transition: all 0.3s ease;
            border-radius: 8px;
            border-color: #dee2e6;
            padding: 0.75rem 0.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        
        .option-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary-light);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        
        .btn-check:checked + .option-card {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.25);
            transform: translateY(-2px);
        }
        
        .btn-check:checked + .option-card .text-muted {
            color: rgba(255,255,255,0.8) !important;
        }
        
        .option-icon {
            margin-bottom: 0.25rem;
            color: var(--primary-color);
        }
        
        .btn-check:checked + .option-card .option-icon {
            color: white;
        }
        
        .form-label {
            font-weight: 500;
            color: #444;
            margin-bottom: 0.5rem;
        }
        
        .nav-tabs .nav-link {
            color: var(--muted-color);
            border: none;
            padding: 0.75rem 1rem;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            background: none;
        }
        
        #submitBtn {
            background: var(--primary-gradient);
            border: none;
            padding: 0.75rem;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        
        #submitBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        
        .btn-outline-primary {
            color: var(--primary-color);
            border-color: #dee2e6;
        }
        
        .btn-outline-primary:hover {
            color: white;
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        /* 表单验证样式 */
        .was-validated .form-control:valid,
        .form-control.is-valid {
            border-color: var(--primary-color) !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%234CAF50' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
            padding-right: calc(1.5em + 0.75rem);
            background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
            background-repeat: no-repeat;
        }
        
        .was-validated .form-control:invalid,
        .form-control.is-invalid {
            border-color: var(--danger-color) !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23f44336'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23f44336' stroke='none'/%3e%3c/svg%3e");
            padding-right: calc(1.5em + 0.75rem);
            background-position: right calc(0.375em + 0.1875rem) center;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
            background-repeat: no-repeat;
        }
        
        .invalid-feedback {
            color: var(--danger-color);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 0.25rem rgba(76, 175, 80, 0.25);
        }
        
        .alert {
            border-radius: 8px;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            margin-bottom: 1rem;
        }
        
        .alert-info {
            background-color: var(--info-bg);
            color: var(--info-color);
            border-left: 4px solid var(--info-color);
        }
        
        .alert-danger {
            background-color: var(--danger-bg);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }
        
        .alert-warning {
            background-color: var(--warning-bg);
            color: var(--warning-color);
            border-left: 4px solid var(--warning-color);
        }
        
        .alert-heading {
            font-weight: 500;
            color: inherit;
        }
        
        .alert i {
            opacity: 0.9;
        }
        
        .small-alert {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
        }
        
        .very-small {
            font-size: 0.7rem;
        }
        
        .bg-light {
            background-color: rgba(230, 246, 230, 0.4) !important;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }
        
        .text-primary {
            color: var(--primary-color) !important;
        }
        
        .text-danger {
            color: var(--danger-color) !important;
        }
        
        .spinner-border.text-primary {
            color: var(--primary-color) !important;
        }
        
        .form-select,
        .form-control {
            border-radius: 6px;
            border-color: #dee2e6;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        /* 美观过渡效果 */
        .tab-pane {
            transition: opacity 0.3s ease;
        }
        
        .tab-pane.fade:not(.show) {
            opacity: 0;
            display: none;
        }
        
        .tab-pane.fade.show {
            opacity: 1;
        }
        
        /* 新增页脚样式 */
        .footer {
            text-align: center;
            padding: 1rem;
            font-size: 0.8rem;
            color: var(--muted-color);
            margin-top: 2rem;
        }
        
        /* 滚动条美化 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c5e1c5;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .card-header {
                padding: 1.25rem 1rem;
            }
            
            .card-body {
                padding: 1.25rem 1rem;
            }
            
            .nav-tabs .nav-link {
                padding: 0.5rem 0.75rem;
            }
            
            .option-cards .col-md-4,
            .option-cards .col-md-6 {
                margin-bottom: 0.5rem;
            }
            
            .bg-light {
                padding: 1rem;
            }
            
            h5 {
                font-size: 1.1rem;
            }
            
            #submitBtn {
                padding: 0.6rem;
            }
        }
        
        @media (max-width: 576px) {
            body {
                padding-top: 0.5rem;
                padding-bottom: 1rem;
            }
            
            .container-fluid {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-11 col-xl-10 col-xxl-9">
                <div class="card shadow-sm">
                    <div class="card-header text-center py-4">
                        <div class="d-flex align-items-center justify-content-center mb-2">
                            <i class="bi bi-airplane-fill text-white me-2 fs-2"></i>
                            <h1 class="h3 mb-0">日本签证材料清单生成器</h1>
                        </div>
                        <p class="small mb-0 text-white-50">根据您的情况生成所需的签证申请材料清单</p>
                    </div>
                    
                    <div class="card-body p-3">
                        <!-- 标签页导航 -->
                        <ul class="nav nav-tabs border-0 mb-4" id="mainTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active px-4 d-flex align-items-center" id="form-tab" data-bs-toggle="tab" data-bs-target="#form-content" 
                                    type="button" role="tab" aria-controls="form-content" aria-selected="true">
                                    <i class="bi bi-pencil-square me-2"></i>填写表单
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link px-4 d-flex align-items-center" id="confirm-tab" data-bs-toggle="tab" data-bs-target="#confirm-content" 
                                    type="button" role="tab" aria-controls="confirm-content" aria-selected="false">
                                    <i class="bi bi-check-circle me-2"></i>确认信息
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link px-4 d-flex align-items-center" id="result-tab" data-bs-toggle="tab" data-bs-target="#result-content" 
                                    type="button" role="tab" aria-controls="result-content" aria-selected="false">
                                    <i class="bi bi-list-check me-2"></i>材料清单
                                </button>
                            </li>
                        </ul>
                        
                        <!-- 标签页内容 -->
                        <div class="tab-content" id="mainTabContent">
                            <!-- 表单标签页 -->
                            <div class="tab-pane fade show active" id="form-content" role="tabpanel" aria-labelledby="form-tab">
                                <div class="container py-4">
                                    <form id="visaForm" class="needs-validation" novalidate>
                                        <!-- 错误提示区域 -->
                                        <div id="formErrorAlert" class="alert alert-danger d-none mb-3"></div>
                                        
                                        <div class="row g-3">
                                            <!-- 左侧列 -->
                                            <div class="col-lg-6">
                                                <div class="bg-light rounded p-3 mb-3">
                                                    <h5 class="mb-3 d-flex align-items-center">
                                                        <i class="bi bi-person-vcard-fill text-primary me-2"></i>基本信息
                                                    </h5>
                                                
                                                    <div class="row g-3">
                                                        <!-- 居住地领区选择 -->
                                                        <div class="mb-4">
                                                            <label class="form-label">居住地领区</label>
                                                            <div class="row g-3">
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="residenceConsulate" id="residenceBeijing" value="beijing" required>
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="residenceBeijing">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">北京</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="residenceConsulate" id="residenceShanghai" value="shanghai">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="residenceShanghai">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">上海</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="residenceConsulate" id="residenceOther" value="other">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="residenceOther">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">其他领区</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div id="otherConsulateWarning" class="alert alert-warning mt-2 d-none">
                                                                其他领区暂不支持在线生成材料清单，请直接联系对应领区。
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- 户籍所在地领区选择 -->
                                                        <div class="mb-4">
                                                            <label class="form-label">户籍所在地领区</label>
                                                            <div class="row g-3">
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="hukouConsulate" id="hukouBeijing" value="beijing" required>
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="hukouBeijing">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">北京</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="hukouConsulate" id="hukouShanghai" value="shanghai">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="hukouShanghai">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">上海</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="hukouConsulate" id="hukouOther" value="other">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="hukouOther">
                                                                        <div class="option-icon">
                                                                            <i class="bi bi-building-fill fs-4"></i>
                                                                        </div>
                                                                        <div class="option-title">其他领区</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="mb-2">
                                                            <label class="form-label small mb-1">申请人身份</label>
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-4 col-lg">
                                                                    <input type="radio" class="btn-check" name="identityType" id="identityEmployed" value="EMPLOYED" required>
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="identityEmployed">
                                                                        <div class="option-icon"><i class="bi bi-briefcase-fill"></i></div>
                                                                        <div class="option-title small">在职人员</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4 col-lg">
                                                                    <input type="radio" class="btn-check" name="identityType" id="identityStudent" value="STUDENT">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="identityStudent">
                                                                        <div class="option-icon"><i class="bi bi-mortarboard-fill"></i></div>
                                                                        <div class="option-title small">在校学生</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4 col-lg">
                                                                    <input type="radio" class="btn-check" name="identityType" id="identityRetired" value="RETIRED">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="identityRetired">
                                                                        <div class="option-icon"><i class="bi bi-award-fill"></i></div>
                                                                        <div class="option-title small">退休人员</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4 col-lg">
                                                                    <input type="radio" class="btn-check" name="identityType" id="identityFreelancer" value="FREELANCER">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="identityFreelancer">
                                                                        <div class="option-icon"><i class="bi bi-laptop-fill"></i></div>
                                                                        <div class="option-title small">自由职业</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4 col-lg">
                                                                    <input type="radio" class="btn-check" name="identityType" id="identityChild" value="CHILD">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="identityChild">
                                                                        <div class="option-icon"><i class="bi bi-emoji-smile-fill"></i></div>
                                                                        <div class="option-title small">学龄前儿童</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="invalid-feedback small">请选择申请人身份</div>
                                                        </div>
                                                        
                                                        <div class="mb-2">
                                                            <label class="form-label small mb-1">申请类型</label>
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="applicationType" id="typeSingle" value="SINGLE" checked required>
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="typeSingle">
                                                                        <div class="option-icon"><i class="bi bi-person-fill"></i></div>
                                                                        <div class="option-title small">单人申请</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="applicationType" id="typeFamily" value="FAMILY">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="typeFamily">
                                                                        <div class="option-icon"><i class="bi bi-people-fill"></i></div>
                                                                        <div class="option-title small">家庭申请</div>
                                                                        <small class="text-muted very-small">全家一起办签证</small>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="applicationType" id="typeBinding" value="BINDING">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="typeBinding">
                                                                        <div class="option-icon"><i class="bi bi-link-45deg"></i></div>
                                                                        <div class="option-title small">作为签证持有人的家属办理</div>
                                                                        <small class="text-muted very-small">家属已有多次往返签证</small>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="applicationType" id="typeEconomic" value="ECONOMIC">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="typeEconomic">
                                                                        <div class="option-icon"><i class="bi bi-credit-card-fill"></i></div>
                                                                        <div class="option-title small">使用家庭成员的经济材料</div>
                                                                        <small class="text-muted very-small">仅单次签证</small>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="invalid-feedback small">请选择申请类型</div>
                                                        </div>

                                                        <!-- 家庭成员信息（仅在选择家庭申请时显示） -->
                                                        <div class="mb-2 d-none" id="familyMembersSection">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <h6 class="mb-0">家庭成员信息</h6>
                                                                <button type="button" class="btn btn-outline-primary btn-sm py-0 px-2" id="addFamilyMemberBtn">
                                                                    <i class="bi bi-plus-circle"></i> 添加家庭成员
                                                                </button>
                                                            </div>
                                                            <div class="alert alert-warning small-alert py-1 px-2 mb-2" role="alert">
                                                                <i class="bi bi-exclamation-triangle-fill me-1"></i> 家庭成员必须与主申请人居住在同一个领区，否则无法共同申请
                                                            </div>
                                                            <div id="familyMembersList" class="mb-1">
                                                                <!-- 家庭成员将通过JavaScript动态添加 -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- 右侧列 -->
                                            <div class="col-lg-6">
                                                <div class="bg-light rounded p-3 mb-3">
                                                    <h5 class="mb-3 d-flex align-items-center">
                                                        <i class="bi bi-gear me-2"></i>办理方式
                                                    </h5>
                                                    <div class="option-cards row g-1">
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="processType" id="processTax" value="TAX" required>
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="processTax">
                                                                <div class="option-icon"><i class="bi bi-receipt-fill"></i></div>
                                                                <div class="option-title small">税单办理</div>
                                                                <small class="text-muted very-small">适用于有个税清单的申请人</small>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="processType" id="processStudent" value="STUDENT">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="processStudent">
                                                                <div class="option-icon"><i class="bi bi-mortarboard-fill"></i></div>
                                                                <div class="option-title small">特定大学生单次</div>
                                                                <small class="text-muted very-small">适用于符合条件的大学生</small>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="processType" id="processNormal" value="NORMAL">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="processNormal">
                                                                <div class="option-icon"><i class="bi bi-briefcase-fill"></i></div>
                                                                <div class="option-title small">普通经济材料办理</div>
                                                                <small class="text-muted very-small">适用于其他经济材料申请</small>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="processType" id="processSimplified" value="SIMPLIFIED">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="processSimplified">
                                                                <div class="option-icon"><i class="bi bi-lightning-fill"></i></div>
                                                                <div class="option-title small">新政简化三年</div>
                                                                <small class="text-muted very-small">适用于符合简化条件的申请人</small>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="invalid-feedback small">请选择办理方式</div>
                                                </div>
                                                
                                                <!-- 大学生状态选择（仅在选择特定大学生单次办理时显示） -->
                                                <div class="mb-2 d-none" id="graduateStatusSection">
                                                    <label class="form-label small mb-1">大学生状态</label>
                                                    <div class="option-cards row g-1">
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="graduateStatus" id="statusCurrent" value="current">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="statusCurrent">
                                                                <div class="option-icon"><i class="bi bi-person-badge-fill"></i></div>
                                                                <div class="option-title small">在读学生</div>
                                                                <small class="text-muted very-small">当前正在学校就读</small>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="graduateStatus" id="statusRecent" value="recent">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="statusRecent">
                                                                <div class="option-icon"><i class="bi bi-person-fill-check"></i></div>
                                                                <div class="option-title small">毕业三年内</div>
                                                                <small class="text-muted very-small">大学毕业不超过三年</small>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="invalid-feedback small">请选择大学生状态</div>
                                                </div>
                                                
                                                <!-- 签证类型选择（仅在选择税单办理或普通经济材料办理时显示） -->
                                                <div class="mb-2 d-none" id="visaTypeSection">
                                                    <label class="form-label small mb-1">签证类型</label>
                                                    <div class="option-cards row g-1">
                                                        <div class="col-md-4">
                                                            <input type="radio" class="btn-check" name="visaType" id="visaSingle" value="SINGLE" required>
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="visaSingle">
                                                                <div class="option-icon"><i class="bi bi-1-circle-fill"></i></div>
                                                                <div class="option-title small">单次签证</div>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="radio" class="btn-check" name="visaType" id="visaThree" value="THREE">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="visaThree">
                                                                <div class="option-icon"><i class="bi bi-3-circle-fill"></i></div>
                                                                <div class="option-title small">三年多次</div>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <input type="radio" class="btn-check" name="visaType" id="visaFive" value="FIVE">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="visaFive">
                                                                <div class="option-icon"><i class="bi bi-5-circle-fill"></i></div>
                                                                <div class="option-title small">五年多次</div>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="invalid-feedback small">请选择签证类型</div>
                                                </div>
                                                
                                                <!-- 家属签证信息部分 -->
                                                <div id="familyVisaSection" class="mt-4 d-none">
                                                    <h5 class="mb-3"><i class="bi bi-people-fill me-2"></i>家属签证信息</h5>
                                                    <div class="row g-3">
                                                        <div class="col-md-6">
                                                            <label for="familyRelation" class="form-label">申请人与持签人关系</label>
                                                            <select id="familyRelation" name="familyRelation" class="form-select" required>
                                                                <option value="" selected disabled>请选择申请人与持签人关系</option>
                                                                <option value="SPOUSE">签证持有人的配偶</option>
                                                                <option value="PARENT">签证持有人的父母</option>
                                                                <option value="CHILD">签证持有人的子女</option>
                                                            </select>
                                                            <div class="invalid-feedback">请选择申请人与持签人关系</div>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label for="familyVisaType" class="form-label">签证持有人的签证类型</label>
                                                            <select id="familyVisaType" name="familyVisaType" class="form-select" required>
                                                                <option value="" selected disabled>请选择签证类型</option>
                                                                <option value="THREE">三年多次签证</option>
                                                                <option value="FIVE">五年多次签证</option>
                                                            </select>
                                                            <div class="invalid-feedback">请选择签证类型</div>
                                                        </div>
                                                        
                                                        <!-- 新增签证持有人身份选项，仅上海领区显示 -->
                                                        <div id="familyHolderIdentitySection" class="col-md-6 d-none">
                                                            <label for="familyHolderIdentity" class="form-label">签证持有人的身份</label>
                                                            <select id="familyHolderIdentity" name="familyHolderIdentity" class="form-select">
                                                                <option value="" selected disabled>请选择签证持有人身份</option>
                                                                <option value="EMPLOYED">在职人员</option>
                                                                <option value="RETIRED">退休人员</option>
                                                                <option value="FREELANCE">自由职业或无业</option>
                                                            </select>
                                                            <div class="invalid-feedback">请选择签证持有人身份</div>
                                                        </div>
                                                        
                                                        <div class="col-12">
                                                            <div class="alert alert-info small p-2 mb-0" role="alert">
                                                                <i class="bi bi-info-circle-fill me-1"></i> 申请人为签证持有人的家属，需要签证持有人持有有效的多次往返签证
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- 经济材料选项（仅在北京领区使用普通经济材料办理时显示） -->
                                                <div class="mb-2 d-none" id="economicMaterialSection">
                                                    <label class="form-label small mb-1">经济材料选项</label>
                                                    <div id="economicMaterialOptions">
                                                        <!-- 单次签证选项 - 北京领区 -->
                                                        <div id="singleVisaOptions" class="d-none option-group beijing-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositSingle" value="deposit_single">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositSingle">
                                                                        <div class="option-icon"><i class="bi bi-piggy-bank-fill"></i></div>
                                                                        <div class="option-title small">10万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="creditCard" value="credit_card">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="creditCard">
                                                                        <div class="option-icon"><i class="bi bi-credit-card-2-front-fill"></i></div>
                                                                        <div class="option-title small">信用卡金卡及以上</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- 三年签证选项 - 北京领区 -->
                                                        <div id="threeVisaOptions" class="d-none option-group beijing-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-12">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositThree" value="deposit_three">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositThree">
                                                                        <div class="option-icon"><i class="bi bi-bank-fill"></i></div>
                                                                        <div class="option-title small">50万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- 五年签证选项 - 北京领区 -->
                                                        <div id="fiveVisaOptions" class="d-none option-group beijing-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-12">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositFive" value="deposit_five">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositFive">
                                                                        <div class="option-icon"><i class="bi bi-building-fill"></i></div>
                                                                        <div class="option-title small">100万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- 单次签证选项 - 上海领区 -->
                                                        <div id="singleVisaOptionsSH" class="d-none option-group shanghai-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositSingleSH" value="deposit_single">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositSingleSH">
                                                                        <div class="option-icon"><i class="bi bi-piggy-bank-fill"></i></div>
                                                                        <div class="option-title small">10万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="creditCardSH" value="credit_card">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="creditCardSH">
                                                                        <div class="option-icon"><i class="bi bi-credit-card-2-front-fill"></i></div>
                                                                        <div class="option-title small">信用卡金卡及以上</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="salarySingleSH" value="salary_single">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="salarySingleSH">
                                                                        <div class="option-icon"><i class="bi bi-cash-stack"></i></div>
                                                                        <div class="option-title small">年工资流水10万以上</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- 三年签证选项 - 上海领区 -->
                                                        <div id="threeVisaOptionsSH" class="d-none option-group shanghai-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositThreeSH" value="deposit_three">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositThreeSH">
                                                                        <div class="option-icon"><i class="bi bi-bank-fill"></i></div>
                                                                        <div class="option-title small">50万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="salaryThreeSH" value="salary_three">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="salaryThreeSH">
                                                                        <div class="option-icon"><i class="bi bi-cash-stack"></i></div>
                                                                        <div class="option-title small">年工资流水20万以上</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- 五年签证选项 - 上海领区 -->
                                                        <div id="fiveVisaOptionsSH" class="d-none option-group shanghai-options">
                                                            <div class="option-cards row g-1">
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="depositFiveSH" value="deposit_five">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="depositFiveSH">
                                                                        <div class="option-icon"><i class="bi bi-building-fill"></i></div>
                                                                        <div class="option-title small">100万以上存款/理财证明</div>
                                                                    </label>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <input type="radio" class="btn-check" name="economicMaterial" id="salaryFiveSH" value="salary_five">
                                                                    <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="salaryFiveSH">
                                                                        <div class="option-icon"><i class="bi bi-cash-stack"></i></div>
                                                                        <div class="option-title small">年工资流水50万以上</div>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="invalid-feedback small">请选择经济材料选项</div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="form-label small mb-1">是否曾经访问日本</label>
                                                    <div class="option-cards row g-1">
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="previousVisit" id="previousVisitYes" value="true" required>
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="previousVisitYes">
                                                                <div class="option-icon"><i class="bi bi-check-circle-fill"></i></div>
                                                                <div class="option-title small">是</div>
                                                                <small class="text-muted very-small">曾经去过日本</small>
                                                            </label>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <input type="radio" class="btn-check" name="previousVisit" id="previousVisitNo" value="false">
                                                            <label class="btn btn-outline-primary option-card h-100 w-100 d-flex flex-column align-items-center justify-content-center py-1" for="previousVisitNo">
                                                                <div class="option-icon"><i class="bi bi-x-circle-fill"></i></div>
                                                                <div class="option-title small">否</div>
                                                                <small class="text-muted very-small">从未去过日本</small>
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="invalid-feedback small">请选择是否曾经访问日本</div>
                                                </div>
                                                
                                                <!-- 提交按钮 -->
                                                <div class="text-center mt-4">
                                                    <button type="submit" class="btn btn-primary btn-lg w-100" id="submitBtn">
                                                        <span class="d-flex align-items-center justify-content-center">
                                                            <span id="submitSpinner" class="spinner-border spinner-border-sm me-2 d-none" role="status" aria-hidden="true"></span>
                                                            <span>下一步：确认信息</span>
                                                            <i class="bi bi-arrow-right ms-2"></i>
                                                        </span>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- 确认信息标签页 -->
                            <div class="tab-pane fade" id="confirm-content" role="tabpanel" aria-labelledby="confirm-tab">
                                <div class="p-3">
                                    <h5 class="mb-4 d-flex align-items-center">
                                        <i class="bi bi-check-circle-fill text-primary me-2"></i>申请人信息确认
                                    </h5>
                                    
                                    <div class="mb-4">
                                        <div class="alert alert-info small mb-3">
                                            <i class="bi bi-info-circle-fill me-2"></i>请确认以下申请人信息正确无误，然后继续生成材料清单
                                        </div>
                                        
                                        <!-- 主申请人信息卡片 -->
                                        <div class="card mb-3 shadow-sm border-0">
                                            <div class="card-header bg-primary text-white py-2">
                                                <h6 class="mb-0"><i class="bi bi-person-fill me-2"></i>主申请人信息</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="mainApplicantInfo" class="row g-3">
                                                    <!-- 这里会通过JavaScript动态填充主申请人信息 -->
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 家庭成员信息卡片（如有） -->
                                        <div id="familyMembersInfoCard" class="card mb-3 shadow-sm border-0 d-none">
                                            <div class="card-header bg-success text-white py-2">
                                                <h6 class="mb-0"><i class="bi bi-people-fill me-2"></i>家庭成员信息</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="familyMembersInfo">
                                                    <!-- 这里会通过JavaScript动态填充家庭成员信息 -->
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 申请详情卡片 -->
                                        <div class="card mb-3 shadow-sm border-0">
                                            <div class="card-header bg-info text-white py-2">
                                                <h6 class="mb-0"><i class="bi bi-clipboard2-fill me-2"></i>申请详情</h6>
                                            </div>
                                            <div class="card-body">
                                                <div id="applicationDetails" class="row g-3">
                                                    <!-- 这里会通过JavaScript动态填充申请详情 -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between">
                                        <button type="button" class="btn btn-outline-secondary" id="backToFormBtn">
                                            <i class="bi bi-arrow-left me-2"></i>返回修改
                                        </button>
                                        <button type="button" class="btn btn-primary" id="confirmAndGenerateBtn">
                                            确认无误，生成材料清单<i class="bi bi-arrow-right ms-2"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 材料清单标签页 -->
                            <div class="tab-pane fade" id="result-content" role="tabpanel" aria-labelledby="result-tab">
                                <div id="loadingIndicator" class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-3 text-muted">正在生成材料清单，请稍候...</p>
                                </div>
                                
                                <div id="resultContent" class="d-none">
                                    <div class="bg-light rounded p-3 mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="mb-0 d-flex align-items-center">
                                                <i class="bi bi-list-check text-primary me-2"></i>签证申请材料清单
                                            </h5>
                                            <div>
                                                <button type="button" class="btn btn-outline-primary btn-sm me-2" id="downloadPdfBtn">
                                                    <i class="bi bi-file-earmark-pdf me-1"></i>下载PDF
                                                </button>
                                                <button type="button" class="btn btn-outline-primary btn-sm" id="copyBtn">
                                                    <i class="bi bi-clipboard me-1"></i>复制清单
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <!-- 添加订单号输入框 -->
                                        <div class="mb-3">
                                            <label for="orderNumber" class="form-label small"><i class="bi bi-tag me-1"></i>订单号（选填）</label>
                                            <input type="text" id="orderNumber" class="form-control form-control-sm" placeholder="请输入订单号，留空将在PDF中预留手写空间">
                                            <div class="form-text small">此订单号将显示在生成的PDF材料清单中</div>
                                        </div>
                                        
                                        <p class="text-muted small mb-3">请根据以下清单准备材料，所有材料按顺序整理并装订。</p>
                                        
                                        <div id="documentList" class="border rounded bg-white p-3">
                                            <!-- 这里会动态填充材料清单 -->
                                        </div>
                                    </div>
                                    
                                    <div class="alert alert-info mb-0">
                                        <h6 class="alert-heading d-flex align-items-center mb-2">
                                            <i class="bi bi-info-circle-fill me-2"></i>注意事项
                                        </h6>
                                        <ol id="noticeItemsList" class="mb-0 small">
                                            <!-- 注意事项由JavaScript动态填充 -->
                                        </ol>
                                    </div>
                                </div>
                                
                                <div id="noResultContent" class="text-center py-5 d-none">
                                    <div class="mb-3">
                                        <i class="bi bi-exclamation-circle-fill text-warning display-4"></i>
                                    </div>
                                    <h5 class="mb-3">暂无材料清单</h5>
                                    <p class="text-muted mb-4">请先填写表单并提交以生成材料清单</p>
                                    <button type="button" class="btn btn-outline-primary" id="goToFormBtn">
                                        <i class="bi bi-pencil-square-fill me-1"></i>前往填写表单
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <div class="footer">
        <div class="container">
            <p class="mb-0">© 2025 日本签证材料清单生成器 | 本工具仅供参考，请以日本驻华使领馆官方要求为准</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <!-- PDF下载功能脚本 -->
    <script>
        // 当DOM加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            // 获取PDF下载按钮元素
            const downloadPdfBtn = document.getElementById('downloadPdfBtn');
            
            // 如果找到了按钮，添加点击事件监听器
            if (downloadPdfBtn) {
                downloadPdfBtn.addEventListener('click', function() {
                    try {
                        // 显示下载中提示
                        const originalButtonText = downloadPdfBtn.innerHTML;
                        downloadPdfBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>下载中...';
                        downloadPdfBtn.disabled = true;
                        
                        // 从当前页面获取表单数据
                        // 从页面的各个选中元素中收集数据
                        const pdfFormData = {};
                        
                        // 收集居住地领区
                        pdfFormData.residenceConsulate = document.querySelector('input[name="residenceConsulate"]:checked')?.value || 'beijing';
                        
                        // 收集户籍所在地领区
                        pdfFormData.hukouConsulate = document.querySelector('input[name="hukouConsulate"]:checked')?.value || 'beijing';
                        
                        // 收集申请人身份
                        pdfFormData.identityType = document.querySelector('input[name="identityType"]:checked')?.value || 'EMPLOYED';
                        
                        // 收集申请类型
                        pdfFormData.applicationType = document.querySelector('input[name="applicationType"]:checked')?.value || 'SINGLE';
                        
                        // 收集办理方式
                        pdfFormData.processType = document.querySelector('input[name="processType"]:checked')?.value || 'NORMAL';
                        
                        // 收集签证类型
                        pdfFormData.visaType = document.querySelector('input[name="visaType"]:checked')?.value || 'SINGLE';
                        
                        // 收集是否曾经访问日本
                        pdfFormData.previousVisit = document.querySelector('input[name="previousVisit"]:checked')?.value || 'false';
                        
                        // 添加申请人姓名（因为表单中没有此字段，直接使用固定值）
                        pdfFormData.applicantName = "申请人";
                        
                        // 获取用户输入的订单号
                        const orderNumber = document.getElementById('orderNumber')?.value || '';
                        if (orderNumber) {
                            pdfFormData.orderNumber = orderNumber;
                        }
                        
                        // 检查特殊情况字段
                        if (pdfFormData.applicationType === 'BINDING') {
                            pdfFormData.familyRelation = document.getElementById('familyRelation')?.value;
                            pdfFormData.familyVisaType = document.getElementById('familyVisaType')?.value;
                        }
                        
                        // 或者，如果当前结果页已经有材料清单，可以直接从页面上获取
                        const documentListContainer = document.getElementById('documentList');
                        if (documentListContainer && documentListContainer.innerHTML.trim()) {
                            console.log('从页面获取材料清单数据');
                            // 我们找到了正在显示的材料清单，说明已经有生成过的数据
                        }
                        
                        // 如果是家庭申请，收集家庭成员数据
                        if (pdfFormData.applicationType === 'FAMILY') {
                            // 这里我们直接实现收集家庭成员数据的函数，而不是调用外部函数
                            const familyMembers = [];
                            // 获取所有家庭成员元素
                            const familyMemberElements = document.querySelectorAll('.family-member');
                            
                            familyMemberElements.forEach((member, index) => {
                                // 获取成员数据
                                const relation = member.querySelector('select[name$="[relation]"]')?.value;
                                const identityType = member.querySelector('select[name$="[identityType]"]')?.value;
                                const residenceConsulate = member.querySelector('select[name$="[residenceConsulate]"]')?.value ||
                                                        document.querySelector('input[name="residenceConsulate"]:checked')?.value;
                                const hukouConsulate = member.querySelector('select[name$="[hukouConsulate]"]')?.value ||
                                                    document.querySelector('input[name="hukouConsulate"]:checked')?.value;
                                
                                if (relation && identityType) {
                                    familyMembers.push({
                                        relation: relation,
                                        identityType: identityType,
                                        residenceConsulate: residenceConsulate,
                                        hukouConsulate: hukouConsulate,
                                        number: index + 1
                                    });
                                }
                            });
                            
                            console.log('添加家庭成员数据:', familyMembers);
                            pdfFormData.familyMembers = familyMembers;
                        }
                        
                        console.log('PDF表单数据:', pdfFormData);
                        
                        // 创建一个表单元素
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = '/api/generate_pdf';
                        form.target = '_blank'; // 在新标签页中打开
                        
                        // 将表单数据添加为隐藏字段
                        for (const key in pdfFormData) {
                            const input = document.createElement('input');
                            input.type = 'hidden';
                            input.name = key;
                            
                            // 对于数组或对象类型的数据，转换为JSON字符串
                            if (typeof pdfFormData[key] === 'object' && pdfFormData[key] !== null) {
                                input.value = JSON.stringify(pdfFormData[key]);
                            } else {
                                input.value = pdfFormData[key];
                            }
                            
                            form.appendChild(input);
                        }
                        
                        // 将表单添加到文档中并提交
                        document.body.appendChild(form);
                        form.submit();
                        
                        // 提交后从文档中移除表单
                        document.body.removeChild(form);
                        
                        // 恢复按钮状态
                        setTimeout(function() {
                            downloadPdfBtn.innerHTML = originalButtonText;
                            downloadPdfBtn.disabled = false;
                        }, 2000);
                    } catch (error) {
                        console.error('生成PDF时出错:', error);
                        alert('生成PDF时出错，请重试。');
                        // 确保重置按钮状态
                        downloadPdfBtn.innerHTML = '<i class="bi bi-file-earmark-pdf me-1"></i>下载PDF';
                        downloadPdfBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html> 