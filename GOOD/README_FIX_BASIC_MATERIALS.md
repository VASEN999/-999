# 上海领区基本材料显示问题修复说明

## 问题描述

发现当申请人居住领区是上海领区时，不管申请人身份是什么（包括自由职业者、退休人员等），基本材料清单中都会显示"在职证明（原件）"。这是不正确的，因为只有在职人员才需要提供在职证明。

具体问题表现为：当申请人选择自由职业身份类型时，生成的基本材料清单为：
```
基本材料
1. 护照原件+首页彩色复印件（剩余有效期大于7个月）
2. 签证申请表（双面打印）
3. 小两寸（3.5cmx4.5cm）白底证件照（近期6个月内拍摄）
4. 户口本复印件（家庭户：户首页+户主页+本人页）
5. 在职证明（原件）
```

其中不应该包含第5项"在职证明（原件）"，因为自由职业者没有在职证明。

## 问题原因

在 `GOOD/document_generator/basic_materials.py` 文件的 `get_materials` 方法中，对于上海领区的基本材料硬编码了"在职证明（原件）"，没有根据申请人的身份类型进行区分：

```python
# 上海领区特有的基本材料
if residence_consulate == 'shanghai':
    basic_materials = [
        "护照原件+首页彩色复印件（剩余有效期大于7个月）",
        "签证申请表（双面打印）",
        "小两寸（3.5cmx4.5cm）白底证件照（近期6个月内拍摄）",
        "户口本复印件（家庭户：户首页+户主页+本人页）",
        "在职证明（原件）"  # 错误：所有身份类型都会包含在职证明
    ]
```

## 修复方案

1. 修改 `GOOD/document_generator/basic_materials.py` 文件的 `get_materials` 方法，将"在职证明（原件）"从默认的上海领区基本材料列表中移除，改为根据申请人的身份类型动态添加：

```python
# 上海领区特有的基本材料
if residence_consulate == 'shanghai':
    basic_materials = [
        "护照原件+首页彩色复印件（剩余有效期大于7个月）",
        "签证申请表（双面打印）",
        "小两寸（3.5cmx4.5cm）白底证件照（近期6个月内拍摄）",
        "户口本复印件（家庭户：户首页+户主页+本人页）"
    ]
    
    # 根据身份类型添加特定材料
    if identity_type == 'EMPLOYED':
        basic_materials.append("在职证明（原件）")
```

2. 确保方法从表单数据中读取 `identityType` 字段：

```python
identity_type = form_data.get('identityType', '')
```

## 测试验证

使用Python脚本分别测试了以下场景：

1. 申请人身份为自由职业者（FREELANCER）
```
基本材料 (自由职业者): ['护照原件+首页彩色复印件（剩余有效期大于7个月）', '签证申请表（双面打印）', '小两寸（3.5cmx4.5cm）白底证件照（近期6个月内拍摄）', '户口本复印件（家庭户：户首页+户主页+本人页）']
```

2. 申请人身份为在职人员（EMPLOYED）
```
基本材料 (在职人员): ['护照原件+首页彩色复印件（剩余有效期大于7个月）', '签证申请表（双面打印）', '小两寸（3.5cmx4.5cm）白底证件照（近期6个月内拍摄）', '户口本复印件（家庭户：户首页+户主页+本人页）', '在职证明（原件）']
```

测试结果表明，修复后系统能正确根据申请人身份类型决定是否包含"在职证明（原件）"在基本材料清单中。 